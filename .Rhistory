scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(.5), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(.5), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(.5)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(.5), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(.5), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(.5)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
# filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(.5), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(.5), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(.5)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(.5), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(.5)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
library(rebus)
library(cowplot)
library(gridExtra)
library(readxl)
library(RColorBrewer)
library(ggrepel)
library(tidyverse)
theme_set(theme_bw() + theme(axis.text = element_text(colour = "black"),
axis.title = element_text(colour = "black", face = "bold"),
strip.background = element_blank(),
strip.text = element_text(face = "bold")))
path = "/Users/Boyuan/Desktop/My publication/17. EMR Adipose RK metabolites/All data RK lipid EMR.xlsx"
color.cmpd = colorRampPalette(brewer.pal(8, "Dark2"))(26) %>% sort() %>% sort()
d.opt.sorbent = read_excel(path, sheet = "sorbent opt")
d.opt.sorbent = d.opt.sorbent %>%
gather(-c(`Data File`, sorbent, `Acq. Date-Time`), key = compound, value = resp)
x = d.opt.sorbent %>% filter(sorbent == "ctrl") %>%
group_by(compound) %>%
summarise(resp.ctrl.mean = mean(resp),
resp.ctrl.sd = sd(resp))
y = d.opt.sorbent %>% filter(sorbent != "ctrl") %>%
group_by(sorbent, compound) %>%
summarise(resp.mean = mean(resp), resp.sd = sd(resp))
d.opt.sorbent.recovery = y %>% left_join(x, by = c("compound")) %>%
mutate(recovery.mean = resp.mean / resp.ctrl.mean * 100,
recovery.sd = sqrt((resp.sd/resp.mean)^2 + (resp.ctrl.sd/resp.ctrl.mean)^2) * recovery.mean  )
d.opt.sorbent.recovery
d.opt.sorbent.recovery$sorbent = d.opt.sorbent.recovery$sorbent %>%
factor(levels = c("Sorbent free", "100 NP (big size)", "100 NP", "75 NP-25 RP", "50 NP-50 RP", "25 NP-75 RP", "100 RP"), ordered = T)
# low recovery compounds without sorbent
l = d.opt.sorbent.recovery %>% filter(sorbent == "Sorbent free") %>%
filter(recovery.mean < 30)
cmpd.lowRecovery = c("RK-Me", "BiAce", "3,4-diHPPA", "3,4-diHPAA", "CA", "4-HBOH")
dg = .3
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1.5) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3,
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3, fontface = "bold",
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
library(rebus)
library(cowplot)
library(gridExtra)
library(readxl)
library(RColorBrewer)
library(ggrepel)
library(tidyverse)
theme_set(theme_bw() + theme(axis.text = element_text(colour = "black"),
axis.title = element_text(colour = "black", face = "bold"),
strip.background = element_blank(),
strip.text = element_text(face = "bold")))
path = "/Users/Boyuan/Desktop/My publication/17. EMR Adipose RK metabolites/All data RK lipid EMR.xlsx"
color.cmpd = colorRampPalette(brewer.pal(8, "Dark2"))(26) %>% sort() %>% sort()
d.opt.sorbent = read_excel(path, sheet = "sorbent opt")
d.opt.sorbent = d.opt.sorbent %>%
gather(-c(`Data File`, sorbent, `Acq. Date-Time`), key = compound, value = resp)
x = d.opt.sorbent %>% filter(sorbent == "ctrl") %>%
group_by(compound) %>%
summarise(resp.ctrl.mean = mean(resp),
resp.ctrl.sd = sd(resp))
y = d.opt.sorbent %>% filter(sorbent != "ctrl") %>%
group_by(sorbent, compound) %>%
summarise(resp.mean = mean(resp), resp.sd = sd(resp))
d.opt.sorbent.recovery = y %>% left_join(x, by = c("compound")) %>%
mutate(recovery.mean = resp.mean / resp.ctrl.mean * 100,
recovery.sd = sqrt((resp.sd/resp.mean)^2 + (resp.ctrl.sd/resp.ctrl.mean)^2) * recovery.mean  )
d.opt.sorbent.recovery
d.opt.sorbent.recovery$sorbent = d.opt.sorbent.recovery$sorbent %>%
factor(levels = c("Sorbent free", "100 NP (big size)", "100 NP", "75 NP-25 RP", "50 NP-50 RP", "25 NP-75 RP", "100 RP"), ordered = T)
# low recovery compounds without sorbent
l = d.opt.sorbent.recovery %>% filter(sorbent == "Sorbent free") %>%
filter(recovery.mean < 30)
cmpd.lowRecovery = c("RK-Me", "BiAce", "3,4-diHPPA", "3,4-diHPAA", "CA", "4-HBOH")
dg = .3
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3, fontface = "bold",
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
theme_set(theme_bw() + theme(axis.text = element_text(colour = "black"),
axis.title = element_text(colour = "black", face = "bold"),
strip.background = element_blank(),
strip.text = element_text(face = "bold")))
path = "/Users/Boyuan/Desktop/My publication/17. EMR Adipose RK metabolites/All data RK lipid EMR.xlsx"
color.cmpd = colorRampPalette(brewer.pal(8, "Dark2"))(26) %>% sort() %>% sort()
d.opt.sorbent = read_excel(path, sheet = "sorbent opt")
d.opt.sorbent = d.opt.sorbent %>%
gather(-c(`Data File`, sorbent, `Acq. Date-Time`), key = compound, value = resp)
x = d.opt.sorbent %>% filter(sorbent == "ctrl") %>%
group_by(compound) %>%
summarise(resp.ctrl.mean = mean(resp),
resp.ctrl.sd = sd(resp))
y = d.opt.sorbent %>% filter(sorbent != "ctrl") %>%
group_by(sorbent, compound) %>%
summarise(resp.mean = mean(resp), resp.sd = sd(resp))
d.opt.sorbent.recovery = y %>% left_join(x, by = c("compound")) %>%
mutate(recovery.mean = resp.mean / resp.ctrl.mean * 100,
recovery.sd = sqrt((resp.sd/resp.mean)^2 + (resp.ctrl.sd/resp.ctrl.mean)^2) * recovery.mean  )
d.opt.sorbent.recovery
d.opt.sorbent.recovery$sorbent = d.opt.sorbent.recovery$sorbent %>%
factor(levels = c("Sorbent free", "100 NP (big size)", "100 NP", "75 NP-25 RP", "50 NP-50 RP", "25 NP-75 RP", "100 RP"), ordered = T)
# low recovery compounds without sorbent
l = d.opt.sorbent.recovery %>% filter(sorbent == "Sorbent free") %>%
filter(recovery.mean < 30)
library(rebus)
library(cowplot)
library(gridExtra)
library(readxl)
library(RColorBrewer)
library(ggrepel)
library(tidyverse)
theme_set(theme_bw() + theme(axis.text = element_text(colour = "black"),
axis.title = element_text(colour = "black", face = "bold"),
strip.background = element_blank(),
strip.text = element_text(face = "bold")))
path = "/Users/Boyuan/Desktop/My publication/17. EMR Adipose RK metabolites/All data RK lipid EMR.xlsx"
color.cmpd = colorRampPalette(brewer.pal(8, "Dark2"))(26) %>% sort() %>% sort()
d.opt.sorbent = read_excel(path, sheet = "sorbent opt")
d.opt.sorbent = d.opt.sorbent %>%
gather(-c(`Data File`, sorbent, `Acq. Date-Time`), key = compound, value = resp)
x = d.opt.sorbent %>% filter(sorbent == "ctrl") %>%
group_by(compound) %>%
summarise(resp.ctrl.mean = mean(resp),
resp.ctrl.sd = sd(resp))
y = d.opt.sorbent %>% filter(sorbent != "ctrl") %>%
group_by(sorbent, compound) %>%
summarise(resp.mean = mean(resp), resp.sd = sd(resp))
d.opt.sorbent.recovery = y %>% left_join(x, by = c("compound")) %>%
mutate(recovery.mean = resp.mean / resp.ctrl.mean * 100,
recovery.sd = sqrt((resp.sd/resp.mean)^2 + (resp.ctrl.sd/resp.ctrl.mean)^2) * recovery.mean  )
d.opt.sorbent.recovery
d.opt.sorbent.recovery$sorbent = d.opt.sorbent.recovery$sorbent %>%
factor(levels = c("Sorbent free", "100 NP (big size)", "100 NP", "75 NP-25 RP", "50 NP-50 RP", "25 NP-75 RP", "100 RP"), ordered = T)
# low recovery compounds without sorbent
l = d.opt.sorbent.recovery %>% filter(sorbent == "Sorbent free") %>%
filter(recovery.mean < 30)
cmpd.lowRecovery = c("RK-Me", "PhLiAce", "3,4-DHPPA", "3,4-DHPAA", "CA", "4-HBOH")
dg = .3
d.opt.sorbent.recovery %>%
filter(!compound %in% cmpd.lowRecovery ) %>%
ggplot(aes(x = sorbent, y = recovery.mean, color = compound, fill = compound)) +
geom_boxplot(data = d.opt.sorbent.recovery, outlier.alpha = 0,
width = .8, fill = "snow1",
aes(group = sorbent)) +
geom_errorbar(aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = 1) +
geom_point(position = position_dodge(dg), shape = 21, fill = "white", size = 2) +
theme(legend.position = "none", panel.grid = element_blank(),
axis.text = element_text(size = 11, colour = "black"),
axis.title = element_text(size = 12, colour = "black")) +
scale_y_continuous(breaks = seq(0, 150, by = 10)) +
coord_cartesian(ylim = c(0, 110)) +
# threshold
geom_segment(aes(x = .5, xend =  7.5, y = 30, yend = 30),
linetype = "dashed", size = 1, color = "firebrick") +
# add special note to low-recovery compound
geom_line(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg), linetype = "dotted") +
geom_errorbar(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(ymin = recovery.mean - recovery.sd,
ymax = recovery.mean + recovery.sd),
position = position_dodge(dg), size = .1, width = .1) +
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, fill = "white", size = 2, stroke = 1) +
# fill with transparent color
geom_point(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(group = compound), position = position_dodge(dg),
shape = 21, size = 2, alpha = .6) +
geom_text_repel(data = d.opt.sorbent.recovery %>% filter(compound %in% cmpd.lowRecovery),
aes(label = compound), size = 3, fontface = "bold",
position = position_dodge(dg)) +
labs(y = "Recovery (%)", x = "Sorbent") +
scale_color_manual(values = color.cmpd) +
scale_fill_manual(values = color.cmpd)
d.opt.sorbent.recovery %>%
filter(compound %in% c("RK-Me", "PhLiAce", "4-HBOH"))
d.opt.sorbent.recovery %>%
filter(compound %in% c("RK-Me", "PhLiAce", "4-HBOH")) %>%
select(sorbent, recovery.mean)
d.opt.sorbent.recovery %>%
filter(compound %in% c("RK-Me", "PhLiAce", "4-HBOH")) %>%
select(sorbent, compound, recovery.mean)
d.opt.sorbent.recovery %>%
filter(compound %in% c("RK-Me", "PhLiAce", "4-HBOH")) %>%
select(sorbent, compound, recovery.mean) %>% spread(sorbent, recovery.mean)
d.opt.sorbent.recovery
d.opt.sorbent.recovery$compound %>% n_distinct()
d.opt.sorbent.recovery %>%
filter(compound %in% c("RK-Me", "PhLiAce", "4-HBOH")) %>%
select(sorbent, compound, recovery.mean) %>% spread(sorbent, recovery.mean)
getwd()
rmarkdown::render_site()
